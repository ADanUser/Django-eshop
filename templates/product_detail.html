{% extends "common.html" %} 

{% block styles %} 
{% load static %}
    <link rel="stylesheet" href="{% static 'detail.css' %}" />
{% endblock styles %} 

{% block content %}

<script>
    window.addEventListener('load', function(){
        let toCartBtn = document.getElementById("add-to-cart");
        decrease = document.getElementById("decrease");
        increase = document.getElementById("increase"); 
        counter = document.getElementById("counter");

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

        toCartBtn.onclick = function (event) {
            fetch(`{% url "cart" %}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken
                },
                body: JSON.stringify({
                    'productiId': 123
                })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.log(error))
        }

        increase.onclick = function (event) {
            let value = parseInt (counter. innerHTML);
            if (isNaN (value)) value = 0;
            if (value < {{ product.stock }}) value++;
            counter.innerHTML = value. toString();
        }

        decrease.onclick = function (event) {
            let value = parseInt (counter.innerHTML);
            if (isNaN (value)) value = 0;
            if (value > 0) value--;
            counter.innerHTML = value.toString();
        }
    })
</script>
<div class="container text-center mt-4">
    <h1 class="mb-3">{{ product.title }}</h1>

    <div class="d-flex flex-column align-items-center">
        <div class="d-flex flex-wrap gap-3 justify-content-center mb-4">
            {% for image in product.productimage_set.all %}
                <div style="width: 300px; height: 300px; overflow: hidden; border-radius: 8px; border: 1px solid #ddd;">
                    <img
                        src="{{ image.image.url }}"
                        class="w-100 h-100"
                        style="object-fit: cover;"
                        alt="{{ product.title }}"
                    />
                </div>           
            {% endfor %}
        </div>

        <div class="text-center" style="max-width: 600px;">
            <p class="fs-5">{{ product.description }}</p>
            <h3 class="my-3">Цена: {{ product.price }}</h3>
            <div class="d-flex flex-column align-items-center my-3">
                <div class="d-flex align-items-center justify-content-center gap-3 mb-2">
                    <button id="decrease" class="qty-circle-btn" type="button">−</button>
                    <b id="counter" class="fs-5 fw-semibold">0</b>
                    <button id="increase" class="qty-circle-btn" type="button">+</button>
                </div>
            </div>
            <a href="#" type="button" class="btn btn-primary btn-lg mt-2" id="add-to-cart">Добавить в корзину</a>
        </div>
    </div>
</div>
{% endblock %}
